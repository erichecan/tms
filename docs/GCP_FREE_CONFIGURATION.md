# GCP å…è´¹é…ç½®æ–¹æ¡ˆ - å®Œå…¨é›¶æˆæœ¬éƒ¨ç½²

> æ›´æ–°æ—¶é—´: 2025-11-30T21:45:00  
> ç›®æ ‡: **$0 æœˆåº¦è´¹ç”¨** - å……åˆ†åˆ©ç”¨ GCP å…è´¹å±‚

## ğŸ¯ ç›®æ ‡

ä¸ºäº†é¿å…ä¹‹å‰è¢« GCP æ‰£è´¹çš„é—®é¢˜ï¼Œæœ¬æ–¹æ¡ˆç¡®ä¿ï¼š
- âœ… **$0 æœˆåº¦è´¹ç”¨**ï¼ˆå¦‚æœæ•°æ®åº“ä½¿ç”¨ Neonï¼‰
- âœ… æ‰€æœ‰æœåŠ¡éƒ½åœ¨å…è´¹å±‚é…ç½®
- âœ… è‡ªåŠ¨æˆæœ¬å‘Šè­¦ï¼ˆä¸Šé™ $10ï¼‰
- âœ… é˜²æ­¢æ„å¤–è´¹ç”¨äº§ç”Ÿ

---

## ğŸ“Š GCP Always-Free å…è´¹é¢åº¦

### æ¯æœˆå…è´¹é¢åº¦

| æœåŠ¡ | å…è´¹é¢åº¦ | æˆ‘ä»¬çš„ä½¿ç”¨ |
|------|---------|-----------|
| **Cloud Run** | 200ä¸‡è¯·æ±‚<br>360,000 GB-ç§’<br>180,000 vCPU-ç§’ | âœ… å®Œå…¨åœ¨å…è´¹å±‚ |
| **Cloud Build** | 120 æ„å»ºåˆ†é’Ÿ | âœ… æ‰‹åŠ¨è§¦å‘ï¼Œ< 120åˆ†é’Ÿ/æœˆ |
| **Cloud Logging** | 50 GiB æ—¥å¿— | âœ… é€šå¸¸ < 10 GiB/æœˆ |
| **Secret Manager** | 6 ä¸ªå¯†é’¥ç‰ˆæœ¬ | âœ… åªéœ€ 3 ä¸ªå¯†é’¥ |
| **Container Registry** | 10 GB å­˜å‚¨ | âœ… é•œåƒé€šå¸¸ < 2 GB |

---

## ğŸ”§ å…è´¹é…ç½®è¯¦æƒ…

### åç«¯æœåŠ¡ (Cloud Run)

```yaml
èµ„æºé…ç½®:
  CPU: 0.25 vCPU          # âœ… å…è´¹å±‚
  å†…å­˜: 512 MiB            # âœ… å…è´¹å±‚
  å¹¶å‘: 80 è¯·æ±‚/å®ä¾‹       # âœ… æé«˜åˆ©ç”¨ç‡
  æœ€å°å®ä¾‹: 0              # âœ… ç©ºé—²æ—¶ $0
  æœ€å¤§å®ä¾‹: 2              # âœ… é™åˆ¶çªå‘
  è¶…æ—¶: 180 ç§’            # âœ… å‡å°‘è®¡è´¹æ—¶é—´
```

**æˆæœ¬**: $0 (åœ¨å…è´¹é¢åº¦å†…)

### å‰ç«¯æœåŠ¡ (Cloud Run)

```yaml
èµ„æºé…ç½®:
  CPU: 0.25 vCPU          # âœ… å…è´¹å±‚
  å†…å­˜: 256 MiB            # âœ… å…è´¹å±‚
  å¹¶å‘: 150 è¯·æ±‚/å®ä¾‹      # âœ… æé«˜åˆ©ç”¨ç‡
  æœ€å°å®ä¾‹: 0              # âœ… ç©ºé—²æ—¶ $0
  æœ€å¤§å®ä¾‹: 2              # âœ… é™åˆ¶çªå‘
  è¶…æ—¶: 120 ç§’            # âœ… å‡å°‘è®¡è´¹æ—¶é—´
```

**æˆæœ¬**: $0 (åœ¨å…è´¹é¢åº¦å†…)

### æ•°æ®åº“

**âœ… ä½¿ç”¨ Neon æ•°æ®åº“ï¼ˆå®Œå…¨å…è´¹ï¼‰**

- âŒ **ä¸è¦ä½¿ç”¨ Cloud SQL** (æœ€ä½ $7-9/æœˆ)
- âœ… **ä½¿ç”¨ Neon Free Tier** ($0/æœˆ)
  - 0.5 GB å­˜å‚¨
  - è¶³å¤Ÿå¼€å‘å’Œæ¼”ç¤ºä½¿ç”¨

### æ„å»ºæœåŠ¡ (Cloud Build)

```yaml
é…ç½®:
  æœºå™¨ç±»å‹: E2_MEDIUM     # âœ… å…è´¹å±‚
  è§¦å‘æ–¹å¼: æ‰‹åŠ¨          # âœ… é¿å…è‡ªåŠ¨æ¶ˆè€—
  ç£ç›˜å¤§å°: 25 GB         # âœ… æœ€å°é…ç½®
```

**æˆæœ¬**: $0 (æ‰‹åŠ¨è§¦å‘ï¼Œ< 120åˆ†é’Ÿ/æœˆ)

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ä½¿ç”¨å…è´¹éƒ¨ç½²è„šæœ¬

```bash
# è¿è¡Œå…è´¹é…ç½®éƒ¨ç½²è„šæœ¬
./scripts/gcp-deploy-free.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
- âœ… ä½¿ç”¨æœ€å°èµ„æºé…ç½® (0.25 CPU, æœ€å°å†…å­˜)
- âœ… è®¾ç½® min-instances=0 (ç©ºé—²æ—¶ $0)
- âœ… é™åˆ¶ max-instances=2 (é˜²æ­¢çªå‘è´¹ç”¨)
- âœ… ä½¿ç”¨å…è´¹å±‚é…ç½®

### 2. è®¾ç½®æˆæœ¬å‘Šè­¦

```bash
# è®¾ç½® $10 æˆæœ¬ä¸Šé™å‘Šè­¦
./scripts/setup-cost-alert.sh
```

---

## ğŸ’° æˆæœ¬ä¿è¯æªæ–½

### 1. æœ€å°å®ä¾‹æ•° = 0

```bash
# ç¡®ä¿æ‰€æœ‰æœåŠ¡ä½¿ç”¨ min-instances=0
gcloud run services update SERVICE_NAME \
  --region=REGION \
  --min-instances=0
```

**ä½œç”¨**: æœåŠ¡ç©ºé—²æ—¶è‡ªåŠ¨åœæ­¢ï¼Œä¸äº§ç”Ÿä»»ä½•è´¹ç”¨

**æ³¨æ„**: é¦–æ¬¡è¯·æ±‚ä¼šæœ‰ 5-10 ç§’å†·å¯åŠ¨å»¶è¿Ÿï¼Œè¿™æ˜¯æ­£å¸¸çš„

### 2. æˆæœ¬é¢„ç®—å‘Šè­¦

è®¾ç½®é¢„ç®—ä¸Šé™ä¸º **$10 USD**ï¼Œåœ¨ä»¥ä¸‹é˜ˆå€¼å‘Šè­¦ï¼š
- 50% ($5) - è­¦å‘Š
- 80% ($8) - ä¸¥é‡è­¦å‘Š  
- 100% ($10) - é¢„ç®—ä¸Šé™

### 3. é…é¢é™åˆ¶

ç›‘æ§ä»¥ä¸‹é…é¢ä½¿ç”¨æƒ…å†µï¼š
- Cloud Run è¯·æ±‚æ•°
- Cloud Build æ„å»ºåˆ†é’Ÿæ•°
- Cloud Logging æ—¥å¿—é‡

---

## âš ï¸ é¿å…æ„å¤–è´¹ç”¨çš„å…³é”®ç‚¹

### âŒ ä¸è¦åšçš„äº‹æƒ…

1. **ä¸è¦ä½¿ç”¨ Cloud SQL**
   - æœ€ä½æˆæœ¬ $7-9/æœˆ
   - ä½¿ç”¨ Neon æ›¿ä»£ï¼ˆå…è´¹ï¼‰

2. **ä¸è¦è®¾ç½® min-instances > 0**
   - å³ä½¿æ²¡æœ‰æµé‡ä¹Ÿä¼šäº§ç”Ÿè´¹ç”¨
   - å¿…é¡»è®¾ä¸º 0

3. **ä¸è¦ä½¿ç”¨å¤§å‹æœºå™¨ç±»å‹**
   - CPU > 1 ä¼šè¶…å‡ºå…è´¹å±‚
   - å†…å­˜ > 512Mi ä¼šè¶…å‡ºå…è´¹å±‚

4. **ä¸è¦å¯ç”¨è‡ªåŠ¨æ‰©å±•**
   - max-instances å¿…é¡»é™åˆ¶ï¼ˆå»ºè®® 2ï¼‰
   - é¿å…çªå‘æµé‡å¯¼è‡´è´¹ç”¨æ¿€å¢

5. **ä¸è¦ä½¿ç”¨ Cloud Storageï¼ˆé™¤éå¿…è¦ï¼‰**
   - è¶…å‡ºå…è´¹é¢åº¦ä¼šäº§ç”Ÿè´¹ç”¨
   - ä¼˜å…ˆä½¿ç”¨ Container Registry

### âœ… å¿…é¡»åšçš„äº‹æƒ…

1. **ä½¿ç”¨ Neon å…è´¹æ•°æ®åº“**
   ```bash
   # ç¡®ä¿ DATABASE_URL æŒ‡å‘ Neon
   echo $DATABASE_URL | grep neon.tech
   ```

2. **è®¾ç½® min-instances=0**
   ```bash
   gcloud run services update SERVICE_NAME \
     --min-instances=0 \
     --region=REGION
   ```

3. **é™åˆ¶ max-instances**
   ```bash
   gcloud run services update SERVICE_NAME \
     --max-instances=2 \
     --region=REGION
   ```

4. **å®šæœŸæ£€æŸ¥è´¹ç”¨**
   ```bash
   # æŸ¥çœ‹å½“å‰è´¹ç”¨
   gcloud billing accounts list
   ```

5. **è®¾ç½®æˆæœ¬å‘Šè­¦**
   ```bash
   ./scripts/setup-cost-alert.sh
   ```

---

## ğŸ” æˆæœ¬ç›‘æ§

### æ¯æ—¥æ£€æŸ¥æ¸…å•

```bash
# 1. æ£€æŸ¥è¿è¡Œä¸­çš„æœåŠ¡
gcloud run services list --region=asia-east2

# 2. æ£€æŸ¥å®ä¾‹æ•°ï¼ˆåº”è¯¥éƒ½æ˜¯ 0 æˆ–å¾ˆå°‘ï¼‰
for service in tms-backend tms-frontend; do
  echo "=== $service ==="
  gcloud run services describe $service \
    --region=asia-east2 \
    --format="value(spec.template.spec.containers[0].resources.limits,spec.template.metadata.annotations)"
done

# 3. æ£€æŸ¥è´¹ç”¨ï¼ˆéœ€è¦å¯ç”¨ Billing APIï¼‰
# åœ¨ GCP Console ä¸­æŸ¥çœ‹: https://console.cloud.google.com/billing
```

### æˆæœ¬æŸ¥çœ‹å‘½ä»¤

```bash
# æŸ¥çœ‹é¡¹ç›®ä½¿ç”¨çš„æœåŠ¡
gcloud services list --enabled --project=$PROJECT_ID

# æŸ¥çœ‹ Cloud Run é…é¢ä½¿ç”¨
gcloud compute project-info describe \
  --project=$PROJECT_ID \
  --format="table(quotas.metric,quotas.limit,quotas.usage)"
```

---

## ğŸ›‘ ç´§æ€¥æ­¢æŸè„šæœ¬

å¦‚æœå‘ç°è´¹ç”¨å¼‚å¸¸ï¼Œç«‹å³è¿è¡Œï¼š

```bash
# åœæ­¢æ‰€æœ‰ Cloud Run æœåŠ¡
./scripts/emergency-stop.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. å°†æ‰€æœ‰æœåŠ¡ min-instances è®¾ä¸º 0
2. å°†æ‰€æœ‰æœåŠ¡ max-instances è®¾ä¸º 0
3. æš‚åœæ‰€æœ‰æ•°æ®åº“å®ä¾‹ï¼ˆå¦‚æœæœ‰ï¼‰
4. åˆ—å‡ºæ‰€æœ‰èµ„æºä¾›æ£€æŸ¥

---

## ğŸ“ˆ æœˆåº¦æˆæœ¬ä¼°ç®—

### æœ€ä½³æƒ…å†µï¼ˆå®Œå…¨å…è´¹ï¼‰

| æœåŠ¡ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Cloud Run (åç«¯) | $0 | åœ¨å…è´¹å±‚ï¼Œmin-instances=0 |
| Cloud Run (å‰ç«¯) | $0 | åœ¨å…è´¹å±‚ï¼Œmin-instances=0 |
| Cloud Build | $0 | æ‰‹åŠ¨è§¦å‘ï¼Œ< 120åˆ†é’Ÿ/æœˆ |
| Secret Manager | $0 | 3 ä¸ªå¯†é’¥ï¼Œ< 6 ä¸ªç‰ˆæœ¬ |
| Cloud Logging | $0 | é€šå¸¸ < 50 GiB/æœˆ |
| Neon æ•°æ®åº“ | $0 | å…è´¹å±‚ |
| **æ€»è®¡** | **$0** | âœ… å®Œå…¨å…è´¹ |

### æœ€åæƒ…å†µï¼ˆä»åœ¨æ§åˆ¶å†…ï¼‰

| æœåŠ¡ | æˆæœ¬ | è¯´æ˜ |
|------|------|------|
| Cloud Run | $0-5 | å¦‚æœè¶…å‡ºå…è´¹é¢åº¦ï¼ˆå¾ˆå°‘å‘ç”Ÿï¼‰ |
| Google Maps API | $0-10 | å–å†³äºä½¿ç”¨é‡ï¼ˆå¯æ§åˆ¶ï¼‰ |
| **æ€»è®¡** | **$0-15** | âš ï¸ é¢„ç®—ä¸Šé™ $10 |

---

## âœ… éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å‰ï¼Œç¡®è®¤ï¼š

- [ ] æ•°æ®åº“ä½¿ç”¨ Neonï¼ˆä¸æ˜¯ Cloud SQLï¼‰
- [ ] æ‰€æœ‰æœåŠ¡ min-instances=0
- [ ] æ‰€æœ‰æœåŠ¡ max-instances â‰¤ 2
- [ ] CPU é…ç½® â‰¤ 0.25
- [ ] å†…å­˜é…ç½® â‰¤ 512Mi
- [ ] å·²è®¾ç½®æˆæœ¬å‘Šè­¦ï¼ˆ$10 ä¸Šé™ï¼‰
- [ ] å·²é˜…è¯»æˆæœ¬ç›‘æ§æ–‡æ¡£

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [GCP Always-Free é¢åº¦](https://cloud.google.com/free/docs/free-cloud-features)
- [Cloud Run å®šä»·](https://cloud.google.com/run/pricing)
- [Neon å…è´¹å±‚](https://neon.tech/pricing)
- [æˆæœ¬ç›‘æ§æŒ‡å—](./GCP_COST_MONITORING.md)

---

**æœ€åæ›´æ–°**: 2025-11-30T21:45:00  
**ç›®æ ‡**: ç¡®ä¿ $0 æœˆåº¦è´¹ç”¨ï¼Œé¿å…æ„å¤–æ‰£è´¹

