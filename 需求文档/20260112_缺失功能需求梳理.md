# 缺失功能产品需求梳理文档

**版本**: 1.0 (基于 V3.2 PRD 及 Legacy 代码库梳理)
**日期**: 2026-01-12
**状态**: 待确认

## 1. 背景
尽管当前版本已包含基础的运单处理和简单的车队展示功能，但对比上一版本（Legacy）及 V3.2 产品文档，核心的**配置管理**及**后台管理**功能严重缺失。本与旨在梳理这些缺失的功能模块，作为后续开发的依据。

## 2. 缺失功能模块详情

### 2.1 规则管理 (Rule Management)
**现状**: 缺失。
**需求描述**:
核心是**智能计费规则引擎**，需要支持向导式创建和灵活配置。
*   **规则向导**: 提供分步向导，引导用户创建复杂的计费规则（如基于重量、距离、区域等）。
*   **模板管理**: 支持预定义计费模板（Pricing Templates），支持增删改查及版本管理。
*   **规则类型**: 支持多种规则类型，包括：
    *   基础定价 (Pricing): 按重量/体积/距离/线路/时间段等。
    *   附加费 (Surcharge): 节假日、偏远地区、燃油附加费等。
    *   折扣 (Discount): 客户等级折扣、批量折扣等。
    *   税费 (Tax)。
*   **实时计算**: 在运单创建/编辑时，基于规则引擎实时计算预估费用 (Estimated Cost) 并展示费用明细 (Breakdown)。

### 2.2 客户管理 (Customer Management)
**现状**: 缺失（仅在运单中有简单的文本输入或下拉，无独立管理模块）。
**需求描述**:
建立完整的客户档案库。
*   **客户列表**: 分页展示客户信息，支持搜索（名称、电话、公司）。
*   **客户详情**:
    *   基本信息: 名称、公司、联系方式、地址（多地址支持）。
    *   结算设置: 信用额度 (Credit Limit)、结算周期。
    *   历史运单: 查看该客户关联的历史运单列表。
*   **增删改查**: 完整的客户生命周期管理。

### 2.3 车队管理 (Fleet Management) - 增强版
**现状**: 现有版本仅有简单的列表展示，缺乏深度管理功能。
**需求描述**:
分为**司机管理**和**车辆管理**两个子模块。

#### 2.3.1 司机管理 (Driver Management)
*   **档案管理**: 姓名、电话、驾照信息、入职日期等。
*   **状态管理**: 定义明确的状态流转（空闲、任务中、休假、离职）。
*   **薪酬设置**: 配置司机的提成比例 (Commission Rate) 或底薪信息（用于财务自动生成）。
*   **关联信息**: 查看当前分配的车辆、正在进行的任务、历史任务记录。

#### 2.3.2 车辆管理 (Vehicle Management)
*   **档案管理**: 车牌号、车型、载重/体积限制、购买日期等。
*   **状态监控**: 车辆状态（可用、维修中、报废）。
*   **维护管理**: 记录维护/保养历史（日期、费用、内容），设置保养提醒（可选）。
*   **定位与轨迹**: (结合 Google Maps) 查看车辆实时位置及历史轨迹（上一版本有 `MapsDemo`/`Tracking` 模块）。

### 2.4 权限与账号管理 (Permission & User Management)
**现状**: 缺失。当前系统可能为单用户或无鉴权状态。
**需求描述**:
实现基于角色的访问控制 (RBAC)。
*   **用户管理 (User Account)**:
    *   创建/编辑系统后台账号。
    *   分配角色。
    *   账号状态管理 (启用/禁用)。
    *   密码重置/管理。
*   **角色管理 (Role Management)**:
    *   定义角色（如：管理员 Admin、调度员 Dispatcher、客服 Operator、财务 Finance、司机 Driver）。
    *   角色赋权：为角色分配具体的菜单访问权限和操作权限（细粒度控制）。
*   **权限控制 (Granular Permissions)**:
    *   菜单级控制：用户只能看到有权限的菜单项。
    *   按钮/操作级控制：如“财务审核”按钮仅对财务角色可见。
    *   数据级控制（可选）：如司机只能看自己的运单（Row-level security 概念）。

### 2.5 其他基础配置 (Other Configurations)
根据 Legacy 代码库结构，以下功能也属于管理类缺失：
*   **货币管理 (Currency Management)**: 支持多货币配置及汇率设置（用于跨国业务）。
*   **批量导入 (Batch Import)**: 支持客户、运单、地址库的 Excel/CSV 批量导入功能，提供模板下载和错误报告。
*   **提醒设置 (Expiry Reminders)**: 驾照过期、保险过期、车辆保养提醒等。

## 3. 下一步计划
确认以上功能范围是否准确。确认后将按优先级（建议顺序：权限 -> 客户/车队 -> 规则 -> 其他）制定详细开发计划。
